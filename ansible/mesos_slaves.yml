---
- name: Ansible Playbook to Deploy Mesos Masters/Slaves and Marathon
  hosts: localhost 
  remote_user: vagrant
  sudo: yes
  gather_facts: yes
  #serial: "10%"
  
  tasks:
    
    - name: Add Repository Key
      command: "sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E56151BF"
      tags: add key

    - name: Add Repository for Mesos 
      apt_repository: repo='deb http://repos.mesosphere.com/ubuntu vivid main' state=present
      tags: add_repo

    - name: Run system update
      apt: update_cache=yes
      tags: update_system

    - name: Installing packages
      apt: name={{ item }} state=present
      with_items:
        - mesos
    
    - name: Stop zookeeper service
      service: name=zookeeper state=stopped enabled=no
      tags: zookeeper_stop
    
    - name: Overide controls
      command: "echo manual > /etc/init/zookeeper.override"
      tags: overide_zookeeper
     
    - name: Push /etc/mesos/zk
      copy: src=templates/zk.j2 dest=/etc/mesos/zk force=yes
      tags: push_conf

    - name: Disable mesos-master service
      service: name=mesos-master state=stopped enabled=no
      tags: mesos-master_stop

    - name: Restart slave service
      service: name=mesos-slave state=restarted enabled=yes
      tags: slave_restarted

